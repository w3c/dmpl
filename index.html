<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Dialogue Manager Programming Language (DMPL)</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script
            src='https://www.w3.org/Tools/respec/respec-w3c-common'
            class='remove'></script>
    <script class='remove'>
        let respecConfig = {
            wg: "Conversational Interfaces Working Group",
            wgURI: "https://www.w3.org/community/conv/",
            wgPublicList: "public-conv",
            specStatus: "CG-FINAL",
            shortName: "dmpl",
            editors: [{
             name: "Nishant Shukla",
             url: "http://shukla.io",
	     w3cid: 112944
            }],
            authors: [{
             name: "Nelson Solano",
             url: "https://www.linkedin.com/in/nelson-solano-24a935126",
	     w3cid: 113168
            }, {
             name: "Victor Zhang",
             url: "https://www.linkedin.com/in/victor-zhang-a8b303108",
	     w3cid: 113469
            }],
            edDraftURI: "https://github.com/w3c/dmpl",
            addSectionLinks: true,
            isPreview: false,
            lint: {
                "check-punctuation": true
            }
        };
    </script>
</head>
<body>

<section id='abstract'>
    <p>
        This specification defines the syntax and semantics of a language for defining the behavior of interactive dialogue.
        It formalizes the representation of states (i.e. fluents), how they change (i.e. actions), and which are preferred (i.e. utility).
        These three components characterize a task, so we call DMPL a task-oriented programming language.
        The interpreter of the language resolves the task by identifying and executing actions that maximize utility.
    </p>
</section>

<section id='sotd'></section>

<section id="conformance"></section>

<section>
    <h2>Introduction</h2>

    This specification aims to decouple the representation of dialogue from its execution.
    For example, conversational interfaces employ artificial intelligence in different ways: 
	finite state machines, path planning, or reinforcement learning systems.
    Regardless of the execution framework, the logical representation may be shared.
    An agreed upon representation of dialogue allows content writers to author and share conversational experiences
	without being distracted by the underlying runtime.
    <section>
        <h2>Scope</h2>
        <i>This section is informative.</i>
        <p>
            This document is limited to specifying the syntax and semantics for a <dfn>task-oriented</dfn> language for interactive behavior.
            One example application of DMPL is an intermediate represenation of content written in authoring tools for non-technical users.
            Another use-case of DMPL is exporting and importing dialogue content authored by writers from different web platforms.
            Technologies closely related to these use-cases are in scope.
        </p>
    </section>
    <section>
        <h2>Goals and Motivation</h2>
        <i>This section is informative.</i>
        <p>
            DMPL is a task-oriented programming language, which may be better explained by extending <a href="https://bit.ly/2Huf6fG">Microsoft's Functional
            Programming vs. Imperative Programming</a> table, shown below.
        </p>
        <table id="comparison-table">
            <tr>
                <th></th>
                <th>Imperative</th>
                <th>Functional</th>
                <th>Task-Oriented</th>
            </tr>
            <tr>
                <th>Programmer Focus</th>
                <td>How to perform tasks (algorithms) and how to track changes in state</td>
                <td>What information is desired and what transformations are required</td>
                <td>Why an action is taken and how information changes</td>
            </tr>
            <tr>
                <th>State Changes</th>
                <td>Important</td>
                <td>Non-existant (for purely functional languages)</td>
                <td>Important</td>
            </tr>
            <tr>
                <th>Order of Execution</th>
                <td>Programmer is mostly responsible</td>
                <td>Hybrid resposibility</td>
                <td>Compiler is mostly responsible</td>
            </tr>
            <tr>
                <th>Loops</th>
                <td>For/While, Recursion</td>
                <td>Recursion</td>
                <td>None, loops are implicit</td>
            </tr>
            <tr>
                <th>Primary Manipulation Unit</th>
                <td>Instances of structures or classes</td>
                <td>Functions</td>
                <td>Utility</td>
            </tr>
        </table>
    </section>

    <p>
        The runtime shall evaluate DMPL in an infinite loop, similar to game-loops inherent in most game engines.
    </p>  

</section>


<section>
    <h2>Language Syntax</h2>
    <i>This section is normative.</i>
    <p>
        This section of the document defines the types used within this specification using
        <a href="https://bit.ly/2g2U4aa">EBNF</a> notation with corresponding
        <a href="https://www.bottlecaps.de/rr/ui">railroad diagrams</a>.
    </p>

    <section>
        <h2><dfn>Atomic Types</dfn></h2>
        <section>
            <h2><code><dfn>literal</dfn></code></h2>
            <p>
                A <a>literal</a> is a terminal atom that may be assigned to a <a>variable</a>,
                used in a <a>dictionary</a>, or used as an operand to build an <a>expression</a>.
            </p>
            <blockquote>
	            <pre>
	                <a>literal</a> ::= <a>string</a> | <a>number</a> | <a>boolean</a> | 'null'
                </pre>
            </blockquote>
            <figure id="literal-railroad">
                <img src="diagrams/literal.png" alt="Literal rail-road diagram">
                <figcaption>Literal</figcaption>
            </figure>

        </section>

        <section>
            <h2><code><dfn>boolean</dfn></code></h2>
            <p>
                A <a>boolean</a> may take on values <code>true</code> or <code>false</code>.
            </p>
            <blockquote>
	            <pre>
	                <a>boolean</a> ::= 'true' | 'false'
                </pre>
            </blockquote>
            <figure id="boolean-railroad">
                <img src="diagrams/boolean.png" alt="Boolean rail-road diagram">
                <figcaption>Boolean</figcaption>
            </figure>
        </section>

        <section>
            <h2><code><dfn>name</dfn></code></h2>
            <p>
                A <a>name</a> is a sequence of characters conforming to those in the [[XML-NAMES]] standard.
            </p>
            <blockquote>
	            <pre>
	                <a>name</a> ::= [ <a href="http://www.w3.org/TR/xml-names/#NT-NCName">http://www.w3.org/TR/xml-names/#NT-NCName</a> ]
                </pre>
            </blockquote>
            <figure id="name-railroad">
                <img src="diagrams/name.png" alt="Name rail-road diagram">
                <figcaption>Name</figcaption>
            </figure>
        </section>

        <section>
            <h2><code><dfn>quote_start</dfn></code></h2>
            <p>
                A <a>quote_start</a> is the starting quotation mark, which indicates the beginning of a string.
            </p>
            <blockquote>
	            <pre>
	                <a>quote_start</a> ::= '"' '`'
                </pre>
            </blockquote>
            <figure id="quote-start-railroad">
                <img src="diagrams/quote_start.png" alt="Quote-start rail-road diagram">
                <figcaption>Quote-start</figcaption>
            </figure>
        </section>

        <section>
            <h2><code><dfn>quote_close</dfn></code></h2>
            <p>
                A <a>quote_close</a> is the ending quotation mark, which indicates the termination of a string.
            </p>
            <blockquote>
	            <pre>
	                <a>quote_close</a> ::= '`' '"'
                </pre>
            </blockquote>
            <figure id="quote-close-railroad">
                <img src="diagrams/quote_close.png" alt="Quote-close rail-road diagram">
                <figcaption>Quote-close</figcaption>
            </figure>
        </section>

        <section>
            <h2><code><dfn>string</dfn></code></h2>
            <p>
                A <a>string</a> literal represents a finite sequence of characters.
                It is surrounded by starting and ending quotation marks.
            </p>
            <blockquote>
	            <pre>
	                <a>string</a> ::= <a>quote_start</a> <a>name</a> <a>quote_close</a>
                </pre>
            </blockquote>
            <figure id="string-railroad">
                <img src="diagrams/string.png" alt="String railroad diagram">
                <figcaption>String</figcaption>
            </figure>
            <pre class="example" title="string literal">
                "`hello`"
            </pre>
        </section>

        <section>
            <h2><code><dfn>digit</dfn></code></h2>
            <p>
                A <a>digit</a> represents a real valued integer in the range [0-9].
            </p>
            <blockquote>
	            <pre>
	                <a>digit</a> ::= [0-9]
                </pre>
            </blockquote>
            <figure id="digit-railroad">
                <img src="diagrams/digit.png" alt="Digit railroad diagram">
                <figcaption>Digit</figcaption>
            </figure>
        </section>

        <section>
            <h2><code><dfn>number</dfn></code></h2>
            <p>
                A <a>number</a> literal may represent either a positive or negative decimal value.
            </p>
            <blockquote>
	            <pre>
	                <a>number</a> ::= '-'? ( <a>digit</a>+ ( '.' <a>digit</a>* )? | '.' <a>digit</a>+ )
                </pre>
            </blockquote>
            <figure id="number-railroad">
                <img src="diagrams/number.png" alt="Number railroad diagram">
                <figcaption>Number</figcaption>
            </figure>
            <pre class="example" title="number literal">
                0.2
            </pre>
        </section>
    </section>

    <section>
        <h2><dfn>Container Structures</dfn></h2>
        <section>
            <h2><code><dfn>variable</dfn></code></h2>
            <p>
                A <a>variable</a> is a named reference to the result of evaluating an <a>expression</a>.
            </p>
            <blockquote>
                    <pre>
                        <a>variable</a> :: = '"' <a>name</a> '"'
                    </pre>
            </blockquote>
            <figure id="variable-railroad">
                <img src="diagrams/variable.png" alt="Variable railroad diagram">
                <figcaption>Variable</figcaption>
            </figure>
            <pre class="example" title="variable">
                "num_correct_answers" // => 3
            </pre>
	    A <a>variable</a> should not be confused with a <a>string</a>, which uses backticks (<code>`</code>) like so:  
	    <pre class="example" title="string uses backticks">
                "`num_correct_answers`" // => "num_correct_answers"
            </pre>
        </section>

        <section>
            <h2><code><dfn>dictionary</dfn></code></h2>
            <p>
                A <a>dictionary</a> is a structure that maps data in key-value pairs.
                The keys and values are all evaluated.
                The keys can be either strings or variables that evaluate to strings.
            </p>
            <blockquote>
                <pre>
                    <a>dictionary</a> : : = '{' ( <a>string</a> | <a>variable</a> ) ':' <a>expression</a>
                                     ( ',' ( <a>string</a> | <a>variable</a> ) ':' <a>expression</a> )* '}'
                </pre>
            </blockquote>
            <figure id="dictionary-railroad">
                <img src="diagrams/dictionary.png" alt="Dictionary railroad diagram">
                <figcaption>Dictionary</figcaption>
            </figure>
            <pre class="example" title="dictionary">
                {"`age`": "x", "`score`": 10, "`name`": "`Joe`"}
            </pre>
        </section>

        <section>
            <h2><code><dfn>expression</dfn></code></h2>
            <p>
                An <a>expression</a> may be evaluated, and that result is stored in memory to be referenced later.
                An expression may be denoted by a JSON array [[RFC7159]], in which case it is also called a <dfn>function</dfn>.
                The first element of the array represents the operator of the <a>function</a>.
                The operator can be either a string or a variable that evaluates to a string.
                All remaining elements of the array constitute the operands.
            </p>
            <blockquote>
	            <pre>
	                <a>expression</a> ::= <a>literal</a>
                              | <a>variable</a>
                              | <a>dictionary</a>
                              | '[' ( <a>literal</a> | <a>variable</a> ) ( ',' <a>expression</a> )* ']'
                </pre>
            </blockquote>
            <figure id="expression-railroad">
                <img src="diagrams/expression.png" alt="Expression railroad diagram">
                <figcaption>Expression</figcaption>
            </figure>


            <table id="expression-table">
                <tr>
                    <th>Return Type</th>
                    <th>Operator</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <th><a>string</a></th>
                    <td><pre>"to_str"</pre></td>
                    <td><pre class="example">["to_str", 4] // => "4"</pre></td>
                </tr>
                <tr>
                    <th><a>string</a></th>
                    <td><pre>"+"</pre></td>
                    <td><pre class="example">["+", "`hello `", "`world`"] // => "hello world"</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"+"</pre></td>
                    <td><pre class="example">["+", 1, 2] // => 3</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"-"</pre></td>
                    <td><pre class="example">["-", 5, 3] // => 2</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"*"</pre></td>
                    <td><pre class="example">["*", 2, 4] // => 8</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"/"</pre></td>
                    <td><pre class="example">["/", 1, 2] // => 0.5</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"//"</pre></td>
                    <td><pre class="example">["//", 1, 2] // => 0</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"%"</pre></td>
                    <td><pre class="example">["%", 168, 2] // => 0</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"to_num"</pre></td>
                    <td><pre class="example">["to_num", "`4`"] // => 4</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"len"</pre></td>
                    <td><pre class="example">["len", ["", 1, 2, 3]] // => 3</pre></td>
                </tr>
                <tr>
                    <th><a>number</a></th>
                    <td><pre>"floor"</pre></td>
                    <td><pre class="example">["floor", 1.5] // => 1</pre></td>
                </tr>
		        <tr>
                    <th>list</th>
                    <td><pre>""</pre></td>
                    <td><pre class="example">["", 1, 2, 3, 4, 5] // => [1, 2, 3, 4, 5]</pre></td>
                </tr>
                <tr>
                    <th>list</th>
                    <td><pre>"++"</pre></td>
                    <td><pre class="example">["++", ["", 1, 2], ["", "`hello`"]] // => [1, 2, "hello"]</pre></td>
                </tr>
                <tr>
                    <th>list</th>
                    <td><pre>"range"</pre></td>
                    <td>
                      <pre class="example">["range", 1, 5] // => [1, 2, 3, 4]</pre>
                      <pre class="example">["range", 0, 8, 2] // => [0, 2, 4, 6]</pre>
                    </td>
                </tr>
                <tr>
                    <th>list</th>
                    <td><pre>"map"</pre></td>
                    <td>
                        <pre class="example">
                            ["map", "to_str", ["", 1, 2, 3]] // => ["1", "2", "3"]
                        </pre>
                        <pre class="example">
                            ["map", "+", ["", 1, 2, 3], ["", 4, 5, 6]] // => [5, 7, 9]
                        </pre>
                    </td>
                </tr>
                <tr>
                    <th>list</th>
                    <td><pre>"foldl"</pre></td>
                    <td>
                        <pre class="example">
                            ["foldl", "+", 0, ["", 1, 2, 3]] // => 6
                        </pre>
                    </td>
                </tr>
                <tr>
                    <th>list</th>
                    <td><pre>"sort"</pre></td>
                    <td>
                        <pre class="example">
                            ["sort", ["", 1, 3, 2]] // => [1, 2, 3]
                        </pre>
                    </td>
                </tr>
                <tr>
                    <th>list</th>
                    <td><pre>"shuffle"</pre></td>
                    <td>
                        <pre class="example">
                            ["shuffle", ["", 1, 2, 3]] // => [1, 3, 2] randomly shuffled
                        </pre>
                    </td>
                </tr>
                <tr>
                    <th>list</th>
                    <td><pre>"reverse"</pre></td>
                    <td>
                        <pre class="example">
                            ["reverse", ["", 1, 2, 3]] // => [3, 2, 1]
                        </pre>
                    </td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"=="</pre></td>
                    <td><pre class="example">["==", 1, 2] // => false</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"!="</pre></td>
                    <td><pre class="example">["!=", 1, 2] // => true</pre></td>

                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>">"</pre></td>
                    <td><pre class="example">[">", 2, 3] // => false</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>">="</pre></td>
                    <td><pre class="example">[">=", 2, 3] // => false</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"<"</pre></td>
                    <td><pre class="example">["<", 2, 3] // => true</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"<="</pre></td>
                    <td><pre class="example">["<=", 2, 3] // => true</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"&&"</pre></td>
                    <td><pre class="example">["&&", true, false] // => false</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"||"</pre></td>
                    <td><pre class="example">["||", true, false] // => true</pre></td>
                </tr>
		        <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"!"</pre></td>
                    <td><pre class="example">["!", false] // => true</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"in"</pre></td>
                    <td><pre class="example">["in", 3, ["", 1, 2, 3]] // => true</pre></td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"input"</pre></td>
                    <td>
                        <pre class="example">["input"] // => true if there's an input</pre>
                        <pre class="example">["input", "`yes`"] // => true if there's an input and it equals "yes"</pre>
                    </td>
                </tr>
		        <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"return"</pre></td>
                    <td>
                        <pre class="example">["return"] // => true if there's an return result from callee</pre>
                    </td>
                </tr>
                <tr>
                    <th><a>boolean</a></th>
                    <td><pre>"?"</pre></td>
                    <td><pre class="example">["?", "`is_greeted`"] // => true if variable defined</pre></td>
                </tr>
		<tr>
                    <th>dynamic</th>
                    <td><pre>"get"</pre></td>
                    <td>
                        <pre class="example">["get", 0, ["", 1, 2, 3]] // => 1</pre>
		                <pre class="example">["get", "`a`", {"`a`": 1}] // => 1</pre>
                    </td>
                </tr>
		        <tr>
                    <th>dynamic</th>
                    <td><pre>"pick"</pre></td>
                    <td>
                        <pre class="example">["pick", ["", 1, 2, 3]] // => 1, 2, or 3 uniformly at random</pre>
                    </td>
                </tr>
                <tr>
                    <th>dynamic</th>
                    <td><pre>"patch"</pre></td>
                    <td>
                        <pre class="example">["patch", {"`a`": 1, "`b`": 2}, {"`a`": 2}] // => {a: 2, b: 2}</pre>
                        Reference: <a href="https://tools.ietf.org/html/rfc7396" target="_blank">RFC 7386</a>
                    </td>
                </tr>
                <tr>
                    <th>dynamic</th>
                    <td><pre>"edit"</pre></td>
                    <td>
                        <pre class="example">["edit", {"`a`": 1}, 2, "`a`"] // => {a: 2}</pre>
                    </td>
                </tr>
                <tr>
                    <th>dynamic</th>
                    <td><pre>"from_list"</pre></td>
                    <td>
                        <pre class="example">["from_list", ["", ["", "`a`", 1], ["", "`b`", 2]]] // => {a: 1, b: 2}</pre>
                    </td>
                </tr>
            </table>
        </section>
    </section>

    <section>
        <h2><dfn>Statements</dfn></h2>
        <section>
            <h2><code><dfn>statement</dfn></code></h2>
            <p>
                A <a>statement</a> may be a non-terminal such as <a>do</a> or <a>fork</a>, or a terminal such as <a>effect</a>.
                Optionally, statements may contain <a>condition</a>, <a>await</a>, or <a>once</a> flags.
            </p>
            <blockquote>
	            <pre>
	                <a>statement</a> ::= '{' ( <a>condition</a> ',' )?
                               ( <a>await</a> ',' )?
                               ( <a>once</a> ',' )?
                               ( <a>effect</a> | <a>do</a> | <a>fork</a> ) '}'
                </pre>
            </blockquote>
            <figure id="statement-railroad">
                <img src="diagrams/statement.png" alt="Statement railroad diagram">
                <figcaption>Statement</figcaption>
            </figure>
        </section>

        <section>
            <h2><code><dfn>condition</dfn></code></h2>
            <p>
                A <a>condition</a> is a boolean expression that runs the statement if the expression evaluates to true.
                A condition check takes priority over other parts of the statement.
		        If a statement does not explicitly contain a condition, then that statement's condition is trivially true.
            </p>
            <blockquote>
	            <pre>
	                <a>condition</a> : : = '"if"' ':'  <a>expression</a>
                </pre>
            </blockquote>
            <figure id="condition-railroad">
                <img src="diagrams/condition.png" alt="Condition railroad diagram">
                <figcaption>Condition</figcaption>
            </figure>
            <pre class="example" title="condition">
                "if": [">", "num_wrong_answers", 3]
            </pre>
        </section>

        <section>
            <h2><code><dfn>await</dfn></code></h2>
            <p>
                An <a>await</a> blocks execution until a boolean expression evaluates to true.
            </p>
            <blockquote>
	            <pre>
	                <a>await</a> ::= '"await"' ':' <a>expression</a>
                </pre>
            </blockquote>
            <figure id="await-railroad">
                <img src="diagrams/await.png" alt="Await railroad diagram">
                <figcaption>Await</figcaption>
            </figure>
            <pre class="example" title="await">
                "await": ["input"]
            </pre>
        </section>

        <section>
            <h2><code><dfn>once</dfn></code></h2>
            <p>
                A <a>once</a> flag specifies whether the statement can only be run once.
                The statement is then ignored in all subsequent instances.
                By default, the once flag is set to false.
            </p>
            <blockquote>
	            <pre>
	                <a>once</a> ::= '"once"' ':' <a>boolean</a>
                </pre>
            </blockquote>
            <figure id="once-railroad">
                <img src="diagrams/once.png" alt="Once railroad diagram">
                <figcaption>Once</figcaption>
            </figure>
            <pre class="example" title="once">
                "once": true
            </pre>
        </section>

        <section>
            <h2><code><dfn>effect</dfn></code></h2>
            <p>
                An <a>effect</a> is a terminal node, meaning it does not produce more statements. There are 6 types of effects.
            </p>
            <blockquote>
	            <pre>
	                <a>effect</a> ::= <a>act</a> | <a>set</a> | <a>def</a> | <a>run</a> | <a>use</a> | <a>pop</a>
                </pre>
            </blockquote>
            <figure id="effect-railroad">
                <img src="diagrams/effect.png" alt="Effect railroad diagram">
                <figcaption>Effect</figcaption>
            </figure>
        </section>

        <section>
            <h2><code><dfn>act</dfn></code></h2>
            <p>
                An <a>act</a> represents an action for the client to realize.
                The expression is evaluated before being sent out to the client. 
		        For example, the payload of the <a>act</a> statement may be represented using 
		        <a href="http://www.mindmakers.org/projects/bml-1-0/wiki">Behavior Markup Language (BML)</a>.
		        The client is then responsible for realizing the behavior defined in the <a>act</a> message.
            </p>
            <blockquote>
	            <pre>
	                <a>act</a> ::= '"@act"' ':' <a>expression</a>
                </pre>
            </blockquote>
            <figure id="act-railroad">
                <img src="diagrams/act.png" alt="Act railroad diagram">
                <figcaption>Act</figcaption>
            </figure>
            <pre class="example" title="act">
                "@act": {
                  "`object`": "`tutor`",
                  "`action`": "`say`",
                  "`params`": {"`intent`": "`greeting`"}
                }
            </pre>
        </section>

        <section>
            <h2><code><dfn>set</dfn></code></h2>
            <p>
                A <a>set</a> updates the value of a <a>variable</a>,
                where the names of the variables and the updated values are specified by evaluating the corresponding expressions.
                The expression specifying the names of the variables must evaluate to a string, 
                a list consisting of only strings, or a dictionary consisting of only strings.
            </p>
            <blockquote>
	            <pre>
	                <a>set</a> ::= '"@set"'  ':' <a>expression</a> ',' '"val"' ':' <a>expression</a>
                </pre>
            </blockquote>
            <figure id="set-railroad">
                <img src="diagrams/set.png" alt="Set railroad diagram">
                <figcaption>Set</figcaption>
            </figure>
            <pre class="example" title="set">
                "@set": "`is_user_greeted`", "val": true
            </pre>
	    <pre class="example" title="set (unpack)">
                "@set": ["", "`is_user_greeted`", "`num_questions`"], "val": ["", true, 7]
            </pre>

        </section>

        <section>
            <h2><code><dfn>def</dfn></code></h2>
            <p>
                A <a>def</a> defines a new <a>expression</a> operator that can be used later in the code.
                The signature of the new <a>expression</a> operator is specified by an expression that must evaluate to a list of strings,
                which maps to the operator name followed by the argument names.
                These argument names are valid only for this scope, and may shadow global variables.
                The result is returned by a <a>pop</a> statement.
            </p>
            <blockquote>
	            <pre>
	                <a>def</a> ::= '"@def"' ':' <a>expression</a> ',' '"val"' ':' <a>statement</a>
                </pre>
            </blockquote>
            <figure id="def-railroad">
                <img src="diagrams/def.png" alt="Def railroad diagram">
                <figcaption>Def</figcaption>
            </figure>
            <pre class="example" title="def">
                "@def": ["", "`inc`", "`x`"], "val": {"@pop": ["+", 1, "x"]}
            </pre>
        </section>

        <section>
            <h2><code><dfn>run</dfn></code></h2>
            <p>
                A <a>run</a> calls DMPL code from another component, optionally passing in arguments.
                The name of the called component is specified by an expression that must evaluate to a string.
                The current variables stored in memory are pushed to a stack before the call, and popped back after the call.
            </p>
            <blockquote>
	            <pre>
	                <a>run</a> ::= '"@run"' ':' <a>expression</a> ( ',' '"args"' ':' <a>expression</a> )?
                </pre>
            </blockquote>
            <figure id="run-railroad">
                <img src="diagrams/run.png" alt="Run railroad diagram">
                <figcaption>Run</figcaption>
            </figure>
            <pre class="example" title="run">
                "@run": "`Outro`"
            </pre>
            <pre class="example" title="run with args">
                "@run": "`Question`", "args": ["", "`What's the largest planet?`", "`Jupiter`"]
            </pre>
        </section>

        <section>
            <h2><code><dfn>use</dfn></code></h2>
            <p>
                A <a>use</a> imports <a>variables</a> and expression operators defined in another component.
                The name of the imported component is specified by an expression that must evaluate to a string.
                The variable and expression operator names can be optionally specified, or all variables and expression operators will be imported.
                It's similar to the Python notation: <code>from os import path</code>.
            </p>
            <blockquote>
	            <pre>
	                <a>use</a> ::= '"@use"' ':' <a>expression</a> ( ',' '"import"' ':' <a>expression</a> )?
                </pre>
            </blockquote>
            <figure id="use-railroad">
                <img src="diagrams/use.png" alt="Use railroad diagram">
                <figcaption>Use</figcaption>
            </figure>
            <pre class="example" title="use">
                "@use": "`MathExpressions`", "import": ["", "`inc`", "`square`", "`exp`"]
            </pre>
        </section>

        <section>
            <h2><code><dfn>pop</dfn></code></h2>
            <p>
                A <a>pop</a> quits execution on the current DMPL code, pops the variables from the stack, and resumes execution from the previous <a>run</a> location.
            </p>
            <blockquote>
	            <pre>
	                <a>pop</a> ::= '"@pop"' ':' <a>expression</a>
                </pre>
            </blockquote>
            <figure id="pop-railroad">
                <img src="diagrams/pop.png" alt="Pop railroad diagram">
                <figcaption>Pop</figcaption>
            </figure>
            <pre class="example" title="pop">
                "@pop": true
            </pre>

        </section>

        <section>
            <h2><code><dfn>do</dfn></code></h2>
            <p>
                A <a>do</a> statement specifies a list of statements to be executed.
            </p>
            <blockquote>
	            <pre>
	                <a>do</a> ::= '"@do"' ':' '[' ( <a>statement</a> ( ',' <a>statement</a> )* )? ']'
                </pre>
            </blockquote>
            <figure id="do-railroad">
                <img src="diagrams/do.png" alt="Do railroad diagram">
                <figcaption>Do</figcaption>
            </figure>
            <pre class="example" title="do">
                "@do": [
                  {"@act": "a"},
                  {"@act": "b"},
                  {"@act": "c"}
                ]
            </pre>
        </section>

        <section>
            <h2><code><dfn>fork</dfn></code></h2>
            <p>
                A <a>fork</a> statement specifies a branch in program-execution for the list of statements that follow.
                Only one is chosen, and the strategy to pick one may be provided using the <a>scheme</a> attribute.
                By default, a greedy scheme is used, meaning the first statement whose <a>condition</a> is met will be chosen.
                More complicated schemes, such as depth-first-search or Monte Carlo Tree Search may be indicated,
                leaving the implementation up to the interpreter.
            </p>
            <blockquote>
	            <pre>
	                <a>fork</a> ::= '"@fork"' ':' '[' ( <a>statement</a> ( ',' <a>statement</a> )* )? ']' ( ',' <a>scheme</a> )?
                </pre>
            </blockquote>
            <figure id="fork-railroad">
                <img src="diagrams/fork.png" alt="Fork railroad diagram">
                <figcaption>Fork</figcaption>
            </figure>
		<p>When no scheme is provided, a fork is essentially the traditional <code>if</code>/<code>elif</code>/<code>else</code> logical flow:</p>
            <pre class="example" title="fork">
                "@fork": [
                  {"if": "is_user_greeted", "@act": "a"},
                  {"if": [">", "num_wrong_answers", 3], "@act": "b"},
                  {"@act": "c"}
                ]
            </pre>
		<p>Providing a scheme allows stochastic behavior to take place:</p>
	    <pre class="example" title="fork with scheme">
"scheme": {"depth": 3}, "@fork": [
  {"@set": "`do_action_1`", "val": "true"},
  {"@set": "`do_action_2`", "val": "true"},
  {"@set": "`do_action_3`", "val": "true"},
  {"if": "is_entry_condition_met", "@set": "`do_action_4`", "val": "true"},
  {"if": false, "@act": "`never reached`"}
]
            </pre>
        </section>

        <section>
            <h2><code><dfn>scheme</dfn></code></h2>
            <p>
                A <a>scheme</a> is associated with a <a>fork</a> statement, and it describes the fork branch resolution strategy.
            </p>
            <blockquote>
	            <pre>
	                <a>scheme</a> ::= '"scheme"' ':' <a>expression</a>
                </pre>
            </blockquote>
            <figure id="scheme-railroad">
                <img src="diagrams/scheme.png" alt="Scheme railroad diagram">
                <figcaption>Scheme</figcaption>
            </figure>
            <pre class="example" title="scheme">
                {"depth": 3}
            </pre>
        </section>

    </section>
</section>
<section>
    <h2>Examples</h2>
    <i>This section is informative.</i>
    <p>
        This section details DMPL conforming example programs.
    </p>
    <p>The following sends "hello world" to the action realizer.
    <pre class="example" title="Hello World!">
        {
          "@act": "`hello world`"
        }
    </pre>
    <br />
    <p>Two actions can be sent sequentially.</p>
    <pre class="example" title="Do-statement">
        {
          "@do": [
            {"@act": "`hello`"},
            {"@act": "`world`"}
          ]
        }
    </pre>
    <br />
    <p>Fork statements allow branching logic.</p>
    <pre class="example" title="If-Else Control Flow">
        {
          "@fork": [
            {"if": ["==", ["+", 2, 2], 4], "@act": "`this statement is run`"},
            {"@act": "`never reached`"}
          ]
        }
    </pre>
    <br />
    <p>Variables can be set and accessed like so.</p>
    <pre class="example" title="Variables">
        {
          "@do": [
            {"@set": "`a`", "val": 1},
            {"@set": "`b`", "val": 2},
            {"@set": "`c`", "val": ["+", "a", "b"]}
          ]
        }
    </pre>
    <br />
    <p>Here we define a new expression called <code>inc</code> which takes an argument called <code>x</code>.</p>
    <pre class="example" title="Define New Expression">
        {
          "@do": [
            {"@def": ["", "`inc`", "`x`"], "val": {"@pop": ["+", 1, "x"]}},
            {"@act", ["`inc`", 5]}
          ]
        }
    </pre>
    <br />
    <p>The set statement allows unpacking a list.</p>
    <pre class="example" title="Unpacking an Array">
        {
          "@do": [
            {"@set": "`content`", "val": ["", "`What's the biggest planet?`", "`Jupiter`"]},
            {"@set": ["", "`Prompt`", "`Correct-Answer`"], "val": "`content`"}
          ]
        }
    </pre>
    <br />
    <p>Run an external file and pass in arguments. The return value can be considered in the following fork statement.</p>
    <pre class="example" title="Running Components">
        {"@do":
          {"@run": "`Question`", "args": ["", "`What's the biggest planet?`", "`Jupiter`"]},
          {"await": ["return"], "@fork": [
            {"if": ["return", true], "@set": "`score`", "val": 100},
            {"@set": "`score`", "val": 0}
          ]}
        }
    </pre>
    <br />
    <p>Expressions and variables may be imported from other files.</p>
    <pre class="example" title="Importing Expressions">
        {
          "@do": [
            {"@use": "`MathExpressions`", "import": ["", "`square`", "`exp`"]},
            {"@act": ["==", ["`square`", 6], ["`exp`", 6, 2]]}
          ]
        }
    </pre>
    <br />
    <p>To halt until a user input is supplied, the await flag on a fork may be used.</p>
    <pre class="example" title="Input Handling">
        {
          "@do": [
            {"@act": "`are you ready?`"},
            {"await": ["input"], "@fork": [
              {"if": ["input", "`yes`"], "@act": "`great`"},
              {"if": ["input", "`no`"], "@act": "`no problem`"}
            ]}
          ]
        }
    </pre>
    <br />
    <p>More immersive dialogue can be achieved by setting and checking variables, such as <code>greeted</code>.</p>
    <pre class="example" title="Greet and Ask Question">
        {
          "scheme": {"depth":  2}, "@fork": [
            {"if": ["!", ["exists", "`greeted`"]], "@set": "`greeted`", "val": false},
            {"if": ["!", "greeted"], "@do": [
              {"@act": "`hello`"},
              {"@set": "`greeted`", "val": true}
            ]},
            {"if": "greeted", "@do": [
              {"@act": "`how are you?`"},
              {"@set": "`asked_feelings`", "val": true},
              {"await": ["input"], "@fork": [
                {"if": ["input", "`good`"], "@act": "`great`"}
              ]}
            ]}
          ]
        }
    </pre>
    <br />
    <p>More complete question and answering scenarios may be constructed.</p>
    <pre class="example" title="Planet Trivia">
        {
          "@fork": [
            {"if": ["!", ["exists", "`Init`"]], "@do": [
              {"@set": "`Init`", "val": true},
              {"@set": "`Wrong-Counter`", "val": 0},
              {"@set": "`Is-Hint1-Given`", "val": false},
              {"@set": "`Is-Hint2-Given`", "val": false},
              {"@set": "`Is-Answer-Given`", "val": false},
              {"@set": "`Num-Hints-Given`", "val": 0},
              {"@set": "`Question`", "val": "`What's the biggest planet?`"},
              {"@set": "`CA`", "val": "`planet.jupiter`"},
              {"@set": "`CA-Response`", "val": "`Exactly!`"},
              {"@set": "`WA1`", "val": "`planet`"},
              {"@set": "`WA1-Response`", "val": "`Nope. That's not the biggest`"},
              {"@set": "`WA2`", "val": "`nonplanet`"},
              {"@set": "`WA2-Response`", "val": "`That's not a planet`"},
              {"@set": "`Hint1`", "val": "`It has a big red spot`"},
              {"@set": "`Hint2`", "val": "`It's name begins with the letter J`"},
              {"@set": "`Answer`", "val": "`The biggest planet is Jupiter`"},
              {"@set": "`Hint-Announcement`", "val": "`Here's a hint`"}
            ]},
            {"@fork": [
              {"if": ["&&", ["<=", "Wrong-Counter", 3], ["!", "Is-Answer-Given"]], "@do": [
                {"@act": "Question"},
                {"@fork": [
                  {"if": ["input", "CA"], "@do": [
                    {"@act": "CA-Response"},
                    {"@set": "`Is-Answer-Given`", "val": true}
                  ]},
                  {"if": ["input", "WA1"], "@do": [
                    {"@act": "WA1-Response"},
                    {"@set": "`Wrong-Counter`", "val":  ["+", 1, "Wrong-Counter"]}
                  ]},
                  {"if": ["input", "WA2"], "@do": [
                    {"@act": "WA2-Response"},
                    {"@set": "`Wrong-Counter`", "val":  ["+", 1, "Wrong-Counter"]}
                  ]},
                  {"@do": [
                    {"@set": "`Wrong-Counter`", "val":  ["+", 1, "Wrong-Counter"]}
                  ]}
                ], "await": ["input"]}
              ]},
              {"if": ["&&", ["!", "Is-Hint1-Given"], ["==", "Wrong-Counter", 1]], "@do": [
                {"@act": "Hint-Announcement"},
                {"@act": "Hint1"},
                {"@set": "`Is-Hint1-Given`", "val": true}
              ]},
              {"if": ["&&", ["!", "Is-Hint2-Given"], ["==", "Wrong-Counter", 2]], "@do": [
                {"@act": "Hint-Announcement"},
                {"@act": "Hint2"},
                {"@set": "`Is-Hint2-Given`", "val": true}
              ]},
              {"if": ["&&", ["!", "Is-Answer-Given"], ["==", "Wrong-Counter", 3]], "@do": [
                {"@act": "Answer"},
                {"@set": "`Is-Answer-Given`", "val": true}
              ]}
            ], "scheme": {"depth": 3}}
          ]
        }
    </pre>
    <br />
    <p>Here's how to handle global interruptions from the user.</p>
    <pre class="example" title="Interruptions">
      {"scheme": {depth: 1}, "@fork": [
        {"@do": [
          {"@act": "`What's your favorite color?`"},
          {"await": ["input"], "@fork": [
            {"if": ["input", "`red`"], "@act": "`That's my favorite color, too!`"}
            {"@act": "`I've never heard of it`"}  
          ]}
        ]},
        {"if": ["input", "`want to quit`"], "@act": "bye"}
      ]}
    </pre>

</section>


<section>
    <h2>Related Technologies</h2>
    <i>This section is informative.</i>
    <section>
        <h2>Artificial Intelligence Modelling Language (AIML)</h2>
        <p>
            AIML tightly couples dialogue logic with natural language processing (NLP).
	        As a result, authoring complicated dialogue systems in AIML requires authors to create an extensive knowledge-base,
            requiring a large number of rules that need to be crafted in order to imitate a natural conversation. 
            This often requires domain expertise in order to capture the intricate nuances associated with open-ended dialogue.
            DMPL, on the other hand, is a general representation for dialogue flow and control without text pattern matching rules.
        </p>
    </section>
    <section>
        <h2>ChatScript</h2>
        <p>
            ChatScript incorporates stronger pattern matching than AIML by using NLU to find the best topic 
            match instead of the best pattern match for an input.
            To incorporate NLU, ChatScript packages a large database of concepts, which are sets of synonyms.
            Defining custom concepts is easily accomplished, but requires careful design in order to avoid 
            being matched with already existing concepts, and to avoid having disjoint inputs being matched with the same concept. 
            DMPL modularizes the NLU, relieving content-writers from having to write complex pattern matching expressions.
        </p>
    </section>
    <section>
        <h2>RiveScript</h2>
        <p>
            RiveScript mainly concerns itself with fetching a user's input message, and leaving everything else to the content writer. 
            It's designed to extend and simplify AIML but still has the overhead of having to write complex
            pattern matching expressions limiting the variability and scope of the dialogue that can be produced.
            DMPL decouples the need to write complicated pattern matching rules, and instead uses utility functions
            to both drive dialogue and respond to the user's input accordingly.
        </p>
    </section>
    <section>
        <h2>Planning Domain Definition Language (PDDL)</h2>
        <p>
            One of the first languages, Planning Domain Definition Language (PDDL) represents tasks by two files: 
            a domain file, which lists available actions, and a corresponding problem file, 
            which defines the initial fluents and goal specifications. 
            Each action defined in the domain file has an entry-condition and a deterministic effect.
            Deterministic planning is a major limitation, since we’re modeling tasks in interactive or unpredictable environments.

            PDDL v3.1 (the latest version as of April 2019) incurs the following limitations:
        </p>

        <ul>
            <li>The definition of a goal in PDDL is restricted to first-order predicate logic. DMPL instead
                defines fluents by pair-wise preferences.
            </li>
            <li>
                PDDL addresses conformant planning, whereas DMPL addresses contingent planning
                <a href="https://bit.ly/2Tjj7cO">(Reference).</a>
            </li>
        </ul>
    </section>
    <section>
        <h2>Probabilistic PDDL (PPDDL)</h2>
        <p>
            Probabilistic PDDL (PPDDL) addresses PDDL's limitation by introducing stochastic effects, 
            so that planning may account for probabilistic outcomes of each action. 
            The PPDDL inference engine can solve for an action sequence that optimizes a user-defined utility function. 
            Through some careful organization and design of the domain file, it is also possible, but not intuitive, 
            to support hierarchical planning within PPDDL. 
            On the other hand, DMPL is designed with hierarchical planning from the get-go, by pushing fluents to a stack once entering a new subroutine.
        </p>
    </section>
    <section>
        <h2>Probabilistic Programming</h2>
        <p>
            Unlike PPDDL, WebPPL and Stan are general purpose probabilistic programming languages that offer a rich selection of 
            statistical models and efficient MCMC sampling.  
            These languages are used to specify general statistical models, which can model an autonomous agent in a stochastic environment. 
            Since they’re general purpose, like DMPL, WebPPL and Stan support user-defined functions and external interfaces to user-defined business logic.
        </p>
    </section>
    <section>
        <h2>Decision Theoretic Languages</h2>
        <p>
            Languages designed specifically for decision problems include IBAL and Markov logic decision networks (MLDN), 
            which come with approximate inference solvers. 
            DTProbLog introduces exact solvers to compute the optimal strategy in a decision-theoretic probabilistic language, 
            using Algebraic Decision Diagrams (ADD). 
            However, DTProbLog is less concerned with sequential decision problems. 
            These languages leverage the Markov Decision Process (MDP) framework, which requires a definition of immediate reward of transitioning from one state to another. 
            Strategically, DMPL disallows users from defining MDP-like rewards and limits the utility function to be defined indirectly through listing pairs of preferred situations. 
            Doing so alleviates the guess-work from the user, and reduces buggy code (most common being infinite-loops due to ill-defined rewards).
        </p>
        <p>
            Missing from most probabilistic programming languages is the runtime of the agent. 
            In other words, once an action-sequence is resolved, instructions for following through with the chosen action on an agent is run elsewhere, 
            usually defined in a separate codebase. 
            DMPL borrows ideas from DTGolog, where both the planner (simulation engine) and evaluator (runtime) consult the same user-written abstract syntax tree. 
            The DMPL code is used both to plan by sampling possible actions and to execute by traversing the same abstract syntax tree.
        </p>
    </section>

</section>
</body>
</html>
